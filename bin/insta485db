#!/bin/bash

set -Eeuo pipefail

if [[ $# -eq 0 ]]; then
    echo "Usage: ./bin/insta485db (create|destroy|reset|dump)"
elif [[ $# -gt 1 ]]; then
    echo "Too much argument!"
elif [[ $1 == "create" ]]; then
    mkdir -p var/uploads
    sqlite3 var/insta485.sqlite3 < sql/schema.sql
    sqlite3 var/insta485.sqlite3 < sql/data.sql
    cp sql/uploads/* var/uploads/
elif [[ $1 == "destroy" ]]; then
    rm -rf var/insta485.sqlite3 var/uploads/
elif [[ $1 == "reset" ]]; then
    rm -rf var/insta485.sqlite3 var/uploads/
    mkdir -p var/uploads
    sqlite3 var/insta485.sqlite3 < sql/schema.sql
    sqlite3 var/insta485.sqlite3 < sql/data.sql
    cp sql/uploads/* var/uploads/
elif [[ $1 == "dump" ]]; then
    sqlite3 -batch -line var/insta485.sqlite3 'SELECT * FROM comments'
    sqlite3 -batch -line var/insta485.sqlite3 'SELECT * FROM following'
    sqlite3 -batch -line var/insta485.sqlite3 'SELECT * FROM likes'
    sqlite3 -batch -line var/insta485.sqlite3 'SELECT * FROM posts'
    qlite3 -batch -line var/insta485.sqlite3 'SELECT * FROM users'
else
    echo "Unknown argument!"
fi